{{ header }}
<div id="subscription-info" class="container">
  <div class="row">{{ column_left }}
    <div id="content" class="col">
      {{ content_top }}

      
      <div class="row mb-3">
        {% if thumb or images %}
          <div class="col-sm-6">
            <div class="image magnific-popup">
              {% if thumb %}
                <a href="{{ image }}" title="{{ heading_title }}"><img src="{{ thumb }}" title="{{ heading_title }}" alt="{{ heading_title }}" class="img-thumbnail mb-3"/></a>
              {% endif %}
              {% if images %}
                <div>
                  {% for image in images %}
                    <a href="{{ image.popup }}" title="{{ heading_title }}"><img src="{{ image.thumb }}" title="{{ heading_title }}" alt="{{ heading_title }}" class="img-thumbnail"/></a>&nbsp;
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          </div>
        {% endif %}
        
        <div class="col-sm-6">
                <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
          <li class="breadcrumb-item"><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
          <h1>{{ heading_title }}</h1>
          
          {% if price_formatted %}
            <ul class="list-unstyled">
              <li><h2><span class="price-new">{{ price_formatted }}</span></h2></li>
            </ul>
          {% endif %}

          <div class="mb-2">
            {% set current_name = null %}
            {% for subscription in subscriptions %}
              {% if subscription.subscription_plan_id == subscription_plan_id or subscription.id == subscription_plan_id %}
                {% set current_name = subscription.name %}
              {% endif %}
            {% endfor %}
            <label class="form-label">Select your subscription: <small class="text-muted">{{ current_name|default('none selected') }}</small></label>
          </div>

            <div class="mb-3">
            <div class="d-flex flex-wrap gap-2" role="group" aria-label="Subscription plans">
              {% for subscription in subscriptions %}
              <button type="button"
                  class="btn-subscription btn btn-outline-dark btn-lg {% if subscription.subscription_plan_id == subscription_plan_id or subscription.id == subscription_plan_id %}active{% endif %}"
                  data-id="{{ subscription.subscription_plan_id|default(subscription.id) }}"
                  aria-pressed="{% if subscription.subscription_plan_id == subscription_plan_id or subscription.id == subscription_plan_id %}true{% else %}false{% endif %}">
                {{ subscription.name }}{% if subscription.price_formatted %} â€” {{ subscription.price_formatted }}{% endif %}
              </button>
              {% endfor %}
            </div>
            </div>

          <script type="text/javascript">
            (function(){
              document.querySelectorAll('.btn-subscription').forEach(function(btn){
                btn.addEventListener('click', function(){
                  var id = this.getAttribute('data-id');
                  var url = new URL(window.location.href);
                  url.searchParams.set('subscription_plan_id', id);
                  window.location = url.toString();
                });
              });
            })();
          </script>

          
          <div class="mb-3">
            <div class="mb-2">
              {% set current_freq_name = null %}
              {% for frequency in frequencies %}
                {% if frequency.frequency_id == frequency_id or frequency.id == frequency_id %}
                  {% set current_freq_name = frequency.name %}
                {% endif %}
              {% endfor %}
              <label class="form-label">Select payment frequency: <small id="selectedFrequency" class="text-muted"></small></label>
            </div>

            <div class="d-flex flex-wrap gap-2" role="group" aria-label="Payment frequencies">
              {% for frequency in frequencies %}
                <button type="button"
                        class="btn-frequency btn btn-outline-dark btn-lg {% if loop.first %}active{% endif %}"
                        data-id="{{ frequency.frequency_id|default(frequency.id) }}"
                        aria-pressed="{% if loop.first %}true{% else %}false{% endif %}">
                  {{ frequency.name }}
                </button>
              {% endfor %}
            </div>
          </div>

          <script type="text/javascript">
          (function(){
            document.querySelectorAll('.btn-frequency').forEach(function(btn){
              btn.addEventListener('click', function(){
                // update selectedFrequency text
                document.getElementById('selectedFrequency').textContent = this.textContent;
              });
            });
          })();
          </script>
          
          <br/>

          <div id="subscription">
            <button type="button" id="button-subscribe" class="btn btn-primary btn-lg btn-block">
              <i class="fa-solid fa-check-circle"></i> {{ button_subscribe }}
            </button>
          </div>
        </div>
      </div>
      
      {% if description %}
        <ul class="nav nav-tabs">
          <li class="nav-item"><a href="#tab-description" data-bs-toggle="tab" class="nav-link active">{{ tab_description }}</a></li>
        </ul>
        <div class="tab-content">
          <div id="tab-description" class="tab-pane active">{{ description }}</div>
        </div>
      {% endif %}
      
      {{ content_bottom }}
    </div>
    {{ column_right }}
  </div>
</div>

<script type="text/javascript"><!--
$('#button-subscribe').on('click', function() {
    // Add subscription to cart or redirect to checkout
    $.ajax({
        url: 'index.php?route=checkout/cart.add&language={{ config_language }}',
        type: 'post',
        data: {
            subscription_plan_id: {{ subscription_plan_id }}
        },
        dataType: 'json',
        success: function(json) {
            if (json['success']) {
                $('#alert').prepend('<div class="alert alert-success alert-dismissible"><i class="fa-solid fa-circle-check"></i> ' + json['success'] + ' <button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>');
                
                $('#header-cart').load('index.php?route=common/cart.info&language={{ config_language }}');
            }
        },
        error: function(xhr, ajaxOptions, thrownError) {
            console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
});

$('.image').magnificPopup({
    type: 'image',
    delegate: 'a',
    gallery: {
        enabled: true
    }
});
//--></script>

{{ footer }}
